version: '3.8'

services:
  oracle-db:
    image: gvenzl/oracle-xe:21.3.0-slim
    container_name: oracle-db
    hostname: oracle-db
    ports:
      - "${DB_PORT:-1521}:1521"
    environment:
      - ORACLE_PASSWORD=${ORACLE_PWD}
      - APP_USER=${APP_USER:-dev_user}
      - APP_USER_PASSWORD=${APP_USER_PWD}
    volumes:
      - oracle_data:/opt/oracle/oradata
    healthcheck:
      test: ["CMD", "healthcheck.sh"]
      interval: 10s
      timeout: 5s
      retries: 10
    networks:
      - apex-net
    restart: always

  ords:
    image: container-registry.oracle.com/database/ords:latest
    container_name: ords-apex
    ports:
      - "${ORDS_PORT:-8080}:8080"
    environment:
      - ORACLE_HOST=oracle-db
      - ORACLE_PORT=1521
      - ORACLE_SERVICE=XE
      - ORACLE_PWD=${ORACLE_PWD}
    depends_on:
      oracle-db:
        condition: service_healthy
    volumes:
      - ords_config:/etc/ords/config
    networks:
      - apex-net
    restart: always

volumes:
  oracle_data:
  ords_config:

networks:
  apex-net:
    driver: bridge
